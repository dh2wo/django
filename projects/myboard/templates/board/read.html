{% extends 'common/base.html' %}
  {% block title %}[글 보기]{% endblock title %}
  {% block body %}
  <script>
    function showUpdateForm(param){
      // alert('댓글번호 : '+ param)
      // ../board/글번호/update_reply?rid=댓글번호
      location.href = 'update_reply?rid=' + param;
    }

    $(document).ready(function(){
      loadReplyList();
    });

    function loadReplyList(){
      let bNum = '{{ board.id }}';
      console.log(bNum);
      $.ajax({
        url: '/board/load_reply/',
        type: 'POST',
        headers: {'X-CSRFTOKEN' : '{{ csrf_token }}'},
        data: {'id' : bNum},
        success: function(response){
          console.log(response)
          $.each(response, function(i, item) {
            console.log(i + " " + item);
          });
        }
      });
    }

  </script>
    <br>
    <h1>#{{ board.id }}</h1>
    <table border="1">
      <tr>
        <th>제목</th>
        <td>{{ board.title }}</td>
      </tr>
      <tr>
        <th>글쓴이</th>
        <td>{{ board.author.username }}</td>
      </tr>
      <tr>
        <th>내용</th>
        <td>{{ board.content }}</td>
      </tr>
      <tr>
        <th>조회수</th>
        <td>{{ board.view_count }}</td>
      </tr>
      <tr>
        <th>날짜</th>
        <td>{{ board.input_date }}</td>
      </tr>
    </table>
    <br />
    <!-- 수정, 삭제 -->
    <!-- username끼리 비교하려면 아래처럼 -->
    {% comment %} {% if board.author == user %} board.author는 user하고 비교한다 {% endcomment %}
    {% if board.author.username == user.username %}
      <a href="{% url 'board:update' board.id %}">수정</a>&nbsp;
      <a href="{% url 'board:delete' board.id %}" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</a>&nbsp;
    {% endif %}
    <hr>
    <div id = 'relpyArea'>
      <!-- 댓글 목록 표시할 곳-->
      <div id = 'replyList'>
        <!-- board 객체 뿐만 아니라 board와 FK로 엮인 객체는 borad.모델이름_set으로 가져올 수 있다 -->
        {% if board.reply_set %}
          {% for reply in board.reply_set.all %}
            {{ reply }} &nbsp;&nbsp;&nbsp;
            <a href = "#" onclick = "javescript:showUpdateForm('{{reply.id}}')">수정</a>/
            <a href = "{% url 'board:delete_reply' id=board.id rid=reply.id %}">삭제</a>
            <br>
          {% endfor %}
        {% else %}
          <p>등록된 댓글이 없습니다.</p>
        {% endif %}
      </div>
      <!-- 댓글 입력 폼-->
      <div id = 'replyForm'> <!-- context에 update에 대한 값을 찾지 못했을 때 -->
      {% if not update %}
        <form action = "{% url 'board:write_reply' board.id %}" method = 'POST'>
        {% csrf_token %}
          <textarea name = 'replyText'></textarea>
          <input type = 'submit' value = '댓글쓰기'>
        </form>
      {% else %} <!-- context에 update가 있을때-->
        <form action = "{% url 'board:update_reply' board.id %}" method = 'POST'>
        {% csrf_token %}
          <input type = 'hidden' name = 'rid' value = {{ reply.id }}>
          <textarea name = 'replyText'>{{ reply.reply_content }}</textarea>
          <input type = 'submit' value = '댓글수정'>
        </form>
      {% endif %}
      </div>
    </div>
    <br />
    <a href="{% url 'board:index' %}">목록으로</a>
  {% endblock body %}
